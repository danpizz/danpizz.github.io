<!DOCTYPE html>
<html lang="it">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Creating an universal static OpenCV library in (Snow) Leopard</title>
  <meta name="description" content="More that a year ago i wrote a post about creating a fat OpenCV 1.0.0 static lib for OS X 10.5.">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://danielepizzoni.it/blog/2009/11/creating-an-universal-static-opencv-library-in-snow-leopard/">
  <link rel="alternate" type="application/rss+xml" title="Daniele Pizzoni" href="/feed.xml">
  
  
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-21153020-1', 'auto');
  ga('send', 'pageview');

</script>
  

  
</head>


  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">
    
    
    <a class="site-title" href="/">Daniele Pizzoni</a>
  
    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
            <a class="page-link" href="/blog/">Blog</a>
            
          
            
            
            <a class="page-link" href="/contatti/">Contatti</a>
            
          
        </div>
      </nav>
    
  </div>
</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Creating an universal static OpenCV library in (Snow) Leopard</h1>
    <p class="post-meta">
      <time datetime="2009-11-10T00:00:00+01:00" itemprop="datePublished">
        
        Nov 10, 2009
      </time>
      </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>More that a year ago i wrote a post about creating a fat OpenCV 1.0.0 static lib for OS X 10.5.</p>

<p>It seems it attracted some attention and it seems that some people found it useful. Unfortunately I have not been working directly with OpenCV for quite a lot of time, until recently, when I found myself in need of recompiling it for Snow Leopard.</p>

<p>So I created for myself a shell script that neatly compiles OpenCV 1.0.0 (download the source from <a href="http://sourceforge.net/projects/opencvlibrary/">Sourceforge</a>). It creates the libs for Leopard or Snow Leopard with i386, x86_64 and ppc architectures.</p>

<p>I have no time to contribute the iPhone part but if someone is willing to submit it I will add it to the script.</p>

<p>To use it first, unpack the OpenCV 1.0.0 sources in a folder, open a terminal window and cd to the folder you unpacked the sources: the ‘ls’ command will list a ‘opencv-1.0.0’ directory in it. Then select the text below and in the terminal launch the ‘pico opencv-build-mac.sh’ command, paste the text, exit pico (with ctrl-x) and execute with ‘bash opencv-build-mac.sh’.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

<span class="c"># Download opencv-1.0.0.tar.gz from http://sourceforge.net/projects/opencvlibrary/</span>
<span class="c"># Unpack it in the same directory where this file resides.</span>
<span class="c"># Execute this file from a terminal with the command &amp;quot;bash opencv-build-mac.sh&amp;quot;</span>
<span class="c">#</span>
<span class="c"># Compiles for Leopard by default.</span>

<span class="c">#set -x</span>

<span class="nv">ROOTDIR</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>
<span class="nv">SRCDIR</span><span class="o">=</span>&amp;quot;<span class="k">${</span><span class="nv">ROOTDIR</span><span class="k">}</span>/opencv-1.0.0&amp;quot;

<span class="c"># Leopard</span>
<span class="nv">SYSROOT</span><span class="o">=</span>&amp;quot;-isysroot /Developer/SDKs/MacOSX10.5.sdk -mmacosx-version-min<span class="o">=</span>10.5&amp;quot;
<span class="nv">SUFFIX</span><span class="o">=</span>&amp;quot;-macosx10.5&amp;quot;

<span class="c"># Snow Leopard</span>
<span class="c">#SYSROOT=&amp;quot;-isysroot /Developer/SDKs/MacOSX10.6.sdk -mmacosx-version-min=10.6&amp;quot;</span>
<span class="c">#SUFFIX=&amp;quot;-macosx10.6&amp;quot;</span>

<span class="nv">I686DIR</span><span class="o">=</span>&amp;quot;<span class="nv">$ROOTDIR</span>/i686&amp;quot;
<span class="nv">PPCDIR</span><span class="o">=</span>&amp;quot;<span class="nv">$ROOTDIR</span>/ppc&amp;quot;
<span class="nv">X86_64DIR</span><span class="o">=</span>&amp;quot;<span class="nv">$ROOTDIR</span>/x86_64&amp;quot;

<span class="nv">CONFFLAGS</span><span class="o">=</span>&amp;quot;--without-imageio --without-python --without-swig --disable-apps
       --disable-dependency-tracking --without-carbon --without-quicktime
       --enable-shared<span class="o">=</span>no --without-gtk&amp;quot;

<span class="c">#</span>
<span class="c"># i686</span>
<span class="c">#</span>
build_i686<span class="o">()</span> <span class="o">{</span>

rm -rf <span class="nv">$I686DIR</span>
mkdir -p <span class="nv">$I686DIR</span>
<span class="nb">pushd</span> <span class="nv">$I686DIR</span>

<span class="k">${</span><span class="nv">SRCDIR</span><span class="k">}</span>/configure <span class="k">${</span><span class="nv">CONFFLAGS</span><span class="k">}</span> <span class="nv">CXXFLAGS</span><span class="o">=</span>&amp;quot;<span class="k">${</span><span class="nv">SYSROOT</span><span class="k">}</span> -arch i686&amp;quot; --target<span class="o">=</span>i686-apple-darwin10 <span class="o">||</span> <span class="nb">exit </span>1
make <span class="o">||</span> <span class="nb">exit </span>1
<span class="nb">popd</span>
<span class="o">}</span>

<span class="c">#</span>
<span class="c"># x86_64</span>
<span class="c">#</span>
build_x86_64 <span class="o">()</span> <span class="o">{</span>

rm -rf <span class="nv">$X86_64DIR</span>
mkdir -p <span class="nv">$X86_64DIR</span>
<span class="nb">pushd</span> <span class="nv">$X86_64DIR</span>

<span class="k">${</span><span class="nv">SRCDIR</span><span class="k">}</span>/configure <span class="k">${</span><span class="nv">CONFFLAGS</span><span class="k">}</span> <span class="nv">CXXFLAGS</span><span class="o">=</span>&amp;quot;<span class="k">${</span><span class="nv">SYSROOT</span><span class="k">}</span> -arch x86_64&amp;quot; --target<span class="o">=</span>x86_64-apple-darwin10 <span class="o">||</span> <span class="nb">exit </span>1
make <span class="o">||</span> <span class="nb">exit </span>1
<span class="nb">popd</span>
<span class="o">}</span>

<span class="c">#</span>
<span class="c"># ppc</span>
<span class="c">#</span>
build_ppc <span class="o">()</span> <span class="o">{</span>

rm -rf <span class="nv">$PPCDIR</span>
mkdir -p <span class="nv">$PPCDIR</span>
<span class="nb">pushd</span> <span class="nv">$PPCDIR</span>

<span class="k">${</span><span class="nv">SRCDIR</span><span class="k">}</span>/configure <span class="k">${</span><span class="nv">CONFFLAGS</span><span class="k">}</span> <span class="nv">CXXFLAGS</span><span class="o">=</span>&amp;quot;<span class="k">${</span><span class="nv">SYSROOT</span><span class="k">}</span> -arch ppc&amp;quot; --host<span class="o">=</span>i686-apple-darwin10 --target<span class="o">=</span>ppc-apple-darwin10 <span class="o">||</span> <span class="nb">exit </span>1
make <span class="o">||</span> <span class="nb">exit </span>1
<span class="nb">popd</span>
<span class="o">}</span>

<span class="c">#</span>
<span class="c"># creating fat lib</span>
<span class="c">#</span>
create_fat_lib<span class="o">()</span> <span class="o">{</span>

lipo -create <span class="nv">$I686DIR</span>/cv/src/.libs/libcv.a
         <span class="nv">$X86_64DIR</span>/cv/src/.libs/libcv.a
         <span class="nv">$PPCDIR</span>/cv/src/.libs/libcv.a
  -output libcv<span class="k">${</span><span class="nv">SUFFIX</span><span class="k">}</span>.a <span class="o">||</span> <span class="nb">exit </span>1

lipo -create <span class="nv">$I686DIR</span>/cxcore/src/.libs/libcxcore.a
         <span class="nv">$X86_64DIR</span>/cxcore/src/.libs/libcxcore.a
         <span class="nv">$PPCDIR</span>/cxcore/src/.libs/libcxcore.a
 -output libcxcore<span class="k">${</span><span class="nv">SUFFIX</span><span class="k">}</span>.a <span class="o">||</span> <span class="nb">exit </span>1

lipo -create <span class="nv">$I686DIR</span>/cvaux/src/.libs/libcvaux.a
         <span class="nv">$X86_64DIR</span>/cvaux/src/.libs/libcvaux.a
         <span class="nv">$PPCDIR</span>/cvaux/src/.libs/libcvaux.a
 -output libcvaux<span class="k">${</span><span class="nv">SUFFIX</span><span class="k">}</span>.a <span class="o">||</span> <span class="nb">exit </span>1

lipo -create <span class="nv">$I686DIR</span>/ml/src/.libs/libml.a
         <span class="nv">$X86_64DIR</span>/ml/src/.libs/libml.a
         <span class="nv">$PPCDIR</span>/ml/src/.libs/libml.a
 -output libml<span class="k">${</span><span class="nv">SUFFIX</span><span class="k">}</span>.a <span class="o">||</span> <span class="nb">exit </span>1

lipo -create <span class="nv">$I686DIR</span>/otherlibs/highgui/.libs/libhighgui.a
         <span class="nv">$X86_64DIR</span>/otherlibs/highgui/.libs/libhighgui.a
         <span class="nv">$PPCDIR</span>/otherlibs/highgui/.libs/libhighgui.a
 -output libhighgui<span class="k">${</span><span class="nv">SUFFIX</span><span class="k">}</span>.a <span class="o">||</span> <span class="nb">exit </span>1
<span class="o">}</span>

<span class="c">#</span>
<span class="c"># main</span>
<span class="c">#</span>

<span class="nb">cd</span> <span class="k">${</span><span class="nv">ROOTDIR</span><span class="k">}</span>
rm <span class="k">*</span>.a

build_i686
build_x86_64
build_ppc
create_fat_lib
</code></pre>
</div>

  </div>

  
</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <!-- <h2 class="footer-heading">Daniele Pizzoni</h2> -->

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <!-- <li>
            
              Daniele Pizzoni
            
          </li> -->
          <li>
            Daniele Pizzoni - P.I. 02632010308
          </li>
            
          <li><a href="mailto:dan@danielepizzoni.it">dan@danielepizzoni.it</a></li>
            
          <li>
            <a href="/cookieprivacypolicy/">Privacy info</a>
          </li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">

          <li>
            <a href="https://www.linkedin.com/in/danielepizzoni/"><span class="icon icon--linkedin"><svg viewBox="0 0 16 16" width="16px" height="16px"><path d="M13.632 13.635h-2.37V9.922c0-.886-.018-2.025-1.234-2.025-1.235 0-1.424.964-1.424 1.96v3.778h-2.37V6H8.51v1.04h.03c.318-.6 1.092-1.233 2.247-1.233 2.4 0 2.845 1.58 2.845 3.637v4.188zM3.558 4.955c-.762 0-1.376-.617-1.376-1.377 0-.758.614-1.375 1.376-1.375.76 0 1.376.617 1.376 1.375 0 .76-.617 1.377-1.376 1.377zm1.188 8.68H2.37V6h2.376v7.635zM14.816 0H1.18C.528 0 0 .516 0 1.153v13.694C0 15.484.528 16 1.18 16h13.635c.652 0 1.185-.516 1.185-1.153V1.153C16 .516 15.467 0 14.815 0z" fill-rule="nonzero"/></svg>
</span><span class="username">danielepizzoni</span></a>

          </li>

          <li>
            <a href="https://stackoverflow.com/users/story/103529"><span class="icon icon--stackoverflow"><svg viewBox="0 0 16 16" width="16px" height="16px"><path d="M12.658 14.577v-4.27h1.423V16H1.23v-5.693h1.42v4.27h10.006zm-8.583-1.423h7.16V11.73h-7.16v1.424zm.173-3.235l6.987 1.46.3-1.38L4.55 8.54l-.302 1.38zm.906-3.37l6.47 3.02.602-1.3-6.47-3.02-.602 1.29zm1.81-3.19l5.478 4.57.906-1.08L7.87 2.28l-.9 1.078zM10.502 0L9.338.863l4.27 5.735 1.164-.862L10.5 0z"/></svg>
</span><span class="username">ildan</span></a>

          </li>

        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Artigiano del Software. Frontend and backend app developer.
</p>
      </div>
    </div>

  </div>


</footer>


  </body>

</html>
